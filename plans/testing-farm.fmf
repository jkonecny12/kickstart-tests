summary: TMT/TFT plan for running kickstart tests on Fedora system
description: |
    Run kickstart tests on Fedora

discover:
    how: shell
    tests:
    - name: 'repository: kickstart-tests'
      framework: shell
      test: |
        set -x

        trap "cp -rv data/logs/ ${TMT_TEST_DATA}/" EXIT INT QUIT PIPE

        cd /root/kickstart-tests 
        scripts/run_travis.sh


      duration: 6h

provision:
    hardware:
        virtualization:
            is-supported: true
        memory: '>= 8 GB'

prepare:
    - name: Update guest
      how: shell
      script: |
        dnf distro-sync -y && dnf install -y git podman

    - name: prepare repository
      how: shell
      script: |
        # Clone repository to where the tests are taken from
        git clone https://github.com/rhinstaller/kickstart-tests /root/kickstart-tests
        cd /root/kickstart-tests
        git fetch origin +refs/pull/*:refs/remotes/origin/pr/*
        git checkout origin/pr/$PR_NUMBER/head

        # Before test execution we are doing rebase, for that we need to configure git correctly
        git config user.name github-actions
        git config user.email github-actions@github.com

execute:
    how: tmt
